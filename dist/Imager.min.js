!function(s,a){"use strict";function r(t,e){for(var i=0,a=t.length,s=[];i<a;i++)s[i]=e(t[i],i);return s}function n(t){return t}function o(){}function l(){return!0}function i(i,a){var s;return function(){var t=this,e=arguments;clearTimeout(s),s=setTimeout(function(){s=null,i.apply(t,e)},a)}}function h(t,e){var i=a;e=e||{},void 0!==t&&("string"==typeof t?(e.selector=t,t=void 0):void 0===t.length&&(e=t,t=void 0)),this.viewportHeight=i.documentElement.clientHeight,this.selector=t?null:e.selector||".delayed-image-load",this.className=e.className||"image-replace",this.fileTypeReqFormat=e.fileTypeReqFormat||".$",this.fileTypeReqFormatString=[],this.fileTypeReqFormatString.webp=this.fileTypeReqFormat.replace("$","webp"),this.fileTypeReqFormatString.jpg=this.fileTypeReqFormat.replace("$","jpg"),this.gif=i.createElement("img"),this.gif.src="data:image/gif;base64,R0lGODlhEAAJAIAAAP///wAAACH5BAEAAAAALAAAAAAQAAkAAAIKhI+py+0Po5yUFQA7",this.gif.className=this.className,this.gif.alt="",this.lazyloadOffset=e.lazyloadOffset||0,this.scrollDelay=e.scrollDelay||250,this.onResize=!e.hasOwnProperty("onResize")||e.onResize,this.lazyload=!!e.hasOwnProperty("lazyload")&&e.lazyload,this.webpBrowserSupport=!0,this.scrolled=!1,this.availablePixelRatios=e.availablePixelRatios||[1,2],this.availableWidths=e.availableWidths||u,this.onImagesReplaced=e.onImagesReplaced||o,this.widthsMap={},this.refreshPixelRatio(),this.widthInterpolator=e.widthInterpolator||n,this.gif.removeAttribute("height"),this.gif.removeAttribute("width"),"function"!=typeof this.availableWidths&&("number"==typeof this.availableWidths.length?this.widthsMap=h.createWidthsMap(this.availableWidths,this.widthInterpolator,this.devicePixelRatio):(this.widthsMap=this.availableWidths,this.availableWidths=p(this.availableWidths)),this.availableWidths=this.availableWidths.sort(function(t,e){return t-e})),this.divs=[],this.add(t||this.selector),this.ready(e.onReady),this.registerFeatureDetectionRunEvent(),this.featureDetectionTest()}var c=a.addEventListener?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)},u=[96,130,165,200,235,270,304,340,375,410,445,485,520,555,590,625,660,695,736],p="function"==typeof Object.keys?Object.keys:function(t){var e,i=[];for(e in t)i.push(e);return i};h.prototype.add=function(t){var t="string"==typeof(t=t||this.selector)?a.querySelectorAll(t):t;t&&t.length&&(t=r(t,n),this.changeDivsToEmptyImages(t),this.divs=this.divs.concat(t))},h.prototype.scrollCheck=function(){var e=this,i=0,a=[];this.scrolled&&(r(this.divs,function(t){e.isPlaceholder(t)&&(++i,e.isThisElementOnScreen(t)&&a.push(t))}),0===i&&s.clearInterval(e.interval),this.changeDivsToEmptyImages(a),this.scrolled=!1)},h.prototype.init=function(){var e=this;this.initialized=!0;var t=l;this.lazyload?(this.registerScrollEvent(),this.scrolled=!0,e.scrollCheck(),t=function(t){return!1===e.isPlaceholder(t)}):this.checkImagesNeedReplacing(this.divs),this.onResize&&this.registerResizeEvent(t),this.onReady()},h.prototype.ready=function(t){this.onReady=t||o},h.prototype.createGif=function(t){if(t.className.match(new RegExp("(^| )"+this.className+"( |$)")))return t;var e=t.getAttribute("data-class"),i=t.getAttribute("data-width"),a=this.gif.cloneNode(!1);return i&&(a.width=i,a.setAttribute("data-width",i)),a.className=(e?e+" ":"")+this.className,a.setAttribute("data-src",t.getAttribute("data-src")),a.setAttribute("alt",t.getAttribute("data-alt")||t.alt||this.gif.alt),t.parentNode.replaceChild(a,t),a},h.prototype.changeDivsToEmptyImages=function(i){var a=this;r(i,function(t,e){i[e]=a.createGif(t)}),this.initialized&&this.checkImagesNeedReplacing(i)},h.prototype.isPlaceholder=function(t){return t.src===this.gif.src},h.prototype.isThisElementOnScreen=function(t){var e=0,i=h.getPageOffset()+this.lazyloadOffset;if(t.offsetParent)for(;e+=t.offsetTop,t=t.offsetParent;);return e<this.viewportHeight+i},h.prototype.checkImagesNeedReplacing=function(t,e){var i=this;e=e||l,this.isResizing||(this.isResizing=!0,this.refreshPixelRatio(),r(t,function(t){e(t)&&i.replaceImagesBasedOnScreenDimensions(t)}),this.isResizing=!1,this.onImagesReplaced(t))},h.prototype.replaceImagesBasedOnScreenDimensions=function(t){var e=t.getAttribute("data-src"),i=h.getNaturalWidth(t),a="function"==typeof this.availableWidths?this.availableWidths(t):this.determineAppropriateResolution(t);t.width=a,!this.isPlaceholder(t)&&a<=i||(this.webpBrowserSupport||(e=e.replace(this.fileTypeReqFormatString.webp,this.fileTypeReqFormatString.jpg)),t.src=this.changeImageSrcToUseNewImageDimensions(e,a),t.removeAttribute("width"),t.removeAttribute("height"))},h.prototype.replaceImagesBasedOnMissingWebpSupport=function(t){var e=t.getAttribute("data-src"),i=h.getNaturalWidth(t),a="function"==typeof this.availableWidths?this.availableWidths(t):this.determineAppropriateResolution(t);t.width=a,!this.isPlaceholder(t)&&a<=i||(this.webpBrowserSupport||(e=e.replace(this.fileTypeReqFormatString.webp,this.fileTypeReqFormatString.jpg)),t.src=this.changeImageSrcToUseNewImageDimensions(e,a),t.removeAttribute("width"),t.removeAttribute("height"))},h.prototype.determineAppropriateResolution=function(t){return h.getClosestValue(t.getAttribute("data-width")||t.parentNode.clientWidth,this.availableWidths)},h.prototype.refreshPixelRatio=function(){this.devicePixelRatio=h.getClosestValue(h.getPixelRatio(),this.availablePixelRatios)},h.prototype.changeImageSrcToUseNewImageDimensions=function(t,e){return t.replace(/{width}/g,h.transforms.width(e,this.widthsMap)).replace(/{pixel_ratio}/g,h.transforms.pixelRatio(this.devicePixelRatio))},h.getPixelRatio=function(t){return(t||s).devicePixelRatio||1},h.createWidthsMap=function(t,e,i){for(var a={},s=t.length;s--;)a[t[s]]=e(t[s],i);return a},h.transforms={pixelRatio:function(t){return 1===t?"":"-"+t+"x"},width:function(t,e){return e[t]||t}},h.getClosestValue=function(t,e){var i=e.length,a=e[i-1];for(t=parseFloat(t);i--;)t<=e[i]&&(a=e[i]);return a},h.prototype.featureDetectionTest=function(){var e=this,i=new Image;function t(t){e.webpBrowserSupport=!(!t||"load"!==t.type)&&1===i.width,a.dispatchEvent(e.featureDetectionRunEvent),a.removeEventListener("featureDetectionRun",e.initFn,!1)}i.onerror=t,i.onload=t,i.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA="},h.prototype.registerResizeEvent=function(t){var e=this;c(s,"resize",i(function(){e.checkImagesNeedReplacing(e.divs,t)},100))},h.prototype.registerFeatureDetectionRunEvent=function(){var t=this;!function(){if("function"==typeof s.CustomEvent)return;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=a.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=s.Event.prototype,s.CustomEvent=t}(),t.featureDetectionRunEvent=new CustomEvent("featureDetectionRun"),t.initFn=function(){setTimeout(function(){t.init()},0)},c(a,"featureDetectionRun",t.initFn())},h.prototype.registerScrollEvent=function(){var t=this;this.scrolled=!1,this.interval=s.setInterval(function(){t.scrollCheck()},t.scrollDelay),c(s,"scroll",function(){t.scrolled=!0}),c(s,"resize",function(){t.viewportHeight=a.documentElement.clientHeight,t.scrolled=!0})},h.getPageOffsetGenerator=function(t){return t?function(){return s.pageYOffset}:function(){return a.documentElement.scrollTop}},h.getNaturalWidth="naturalWidth"in new Image?function(t){return t.naturalWidth}:function(t){var e=a.createElement("img");return e.src=t.src,e.width},h.getPageOffset=h.getPageOffsetGenerator(Object.prototype.hasOwnProperty.call(s,"pageYOffset")),h.applyEach=r,h.addEvent=c,h.debounce=i,"object"==typeof module&&"object"==typeof module.exports?module.exports=exports=h:"function"==typeof define&&define.amd?define(function(){return h}):"object"==typeof s&&(s.Imager=h)}(window,document);